
@{
    ViewBag.Title = "RADA Logistics | New Users";
}

<link href="~/Stylee/NewUsersStylee.css" rel="stylesheet" />

<div class="container" style="text-align: center; width: 100%; height: 100%">

    <div style="text-align: center; min-width: 100%; ">

        @*<h3 style="font-weight: 700;">Rada Logistics system</h3>

            <p style="text-align: center;">&nbsp;</p>
            <img src="~/Pictures/add.png" height="90" />
            <p style="text-align: center;">&nbsp;</p>*@

        <style>
            .page-title {
                text-align: center;
                font-size: 21px;
                font-weight: 700;
                color: #2c3e50;
                margin-bottom: 15px;
            }

            .section-subtitle {
                text-align: center;
                font-size: 17px;
                font-weight: 500;
                color: #555;
                margin-bottom: 25px;
            }
        </style>

        <h2 class="page-title"> Genera un nuevo usuario </h2>
        <h4 class="section-subtitle"> Completa los siguientes campos para dar de alta a un usuario </h4>

        <hr>
        <div style=" display: flex; justify-content: center; align-items: center; height: auto;">
            <button class="animated-button" onclick="location.href='@Url.Action("Home","Users")'">
                <svg xmlns="http://www.w3.org/2000/svg" class="arr-2" viewBox="0 0 24 24">
                    <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                </svg>
                <span class="text"> Regresar </span>
                <span class="circle"></span>
                <svg xmlns="http://www.w3.org/2000/svg" class="arr-1" viewBox="0 0 24 24">
                    <path d="M16.1716 10.9999L10.8076 5.63589L12.2218 4.22168L20 11.9999L12.2218 19.778L10.8076 18.3638L16.1716 12.9999H4V10.9999H16.1716Z"></path>
                </svg>
            </button>
        </div>
        <hr>

       @using (Html.BeginForm("GetUser", "Users", FormMethod.Post))
        {
            <h5 class="typelbl" style="text-align: center; font-size: 15px; font-weight: 700; ">Tipo de Usuario:</h5>
            <div class="group">
                <select name="TypeUsers" id="TypeUsers" class="form-control" style="max-width: 30vh; color: black; text-align: center">
                    <option value="ADMINISTRATOR">ADMINISTRATOR</option>
                    <option value="HISENSE">HISENSE</option>
                    <option value="RADA">RADA</option>
                </select>
            </div>
            <p style="text-align: center;">&nbsp;</p>

            <input id="UserCreate" name="UserCreate" value="@ViewBag.Create" hidden="hidden" />

            <h5 class="Tittlelabel" style="font-weight: 700;"> Informacion Personal </h5>
            <hr style="border: 1px solid #CECECE; width: 35vh; margin: 5px auto ">
            <p style="text-align: center;">&nbsp;</p>
            <div class="group">
                <input type="text" id="Username" name="Username" required>
                <span class="highlight"></span>
                <span class="bar"></span>
                <label>Ingresa Nombre de usuario:</label>
            </div>

            <div class="group">
                <input type="number" id="Credentials" name="Credentials" required>
                <span class="highlight"></span>
                <span class="bar"></span>
                <label>Numero de empleado:</label>
            </div>

            <h5 class="Tittlelabel" style="font-weight: 700;"> Correo e inicio de sesion </h5>
            <hr style="border: 1px solid #CECECE; width: 35vh; margin: 5px auto ">
            <p style="text-align: center;">&nbsp;</p>

            <div class="group">
                <input type="text" id="Email" name="Email" required>
                <span class="highlight"></span>
                <span class="bar"></span>
                <label>Ingresa Correo Electronico:</label>
            </div>

            <div class="group">
                <input type="text" id="Log" name="Log" required>
                <span class="highlight"></span>
                <span class="bar"></span>
                <label>Ingresa Nombre de usuario (Inicio de Sesion):</label>
            </div>

            <div class="group">
                <input type="password" id="Pass" name="Pass" required>
                <span class="highlight"></span>
                <span class="bar"></span>
                <label>Ingresa clave de acceso:</label>
            </div>

            <h5 class="Tittlelabel"> Message: @ViewBag.message </h5>
            <p style="text-align: center;">&nbsp;</p>
            <button type="submit" class="Bto_saved">
                ✅ Guardar
            </button>

            <p style="text-align: center;">&nbsp;</p>
            <p style="text-align: center;">&nbsp;</p>

            <h4 class="Tittlelabel" style="color:red"> @ViewBag.message </h4>
        }

        <p style="text-align: center;">&nbsp;</p>
        <h4 class="Tittlelabel" style="font-weight: 700;"> Usuarios registrados Recientemente </h4>
        <h5 class="Tittlelabel"> Total: @ViewBag.Count </h5>
    </div>

</div>

<div class="table-scroll">
    <ul class="responsive-table">
        <li class="table-header" id="tableData">

            <div class="col col-1" style="text-align: center; flex-basis: 10%;">ID</div>

            <div class="col col-2" style="text-align: center; flex-basis: 25%">Usuario</div>

            <div class="col col-3" style="text-align: center; flex-basis: 5%">Credenciales</div>

            <div class="col col-4" style="text-align: center; flex-basis: 20%"> Inicio de Sesion </div>

            <div class="col col-5" style="text-align: center; flex-basis: 10%"> Tipo de Usuario </div>

            <div class="col col-6" style="text-align: center; flex-basis: 20%"> Fecha </div>

            <div class="col col-7" style="text-align: center; flex-basis: 25%">Opciones</div>

        </li>
       @foreach (var person in ViewBag.Records)
        {
            <li class="table-row" id="tblCustomers">

                <div class="col col-1" data-label="ID" style="text-align: center; flex-basis: 10%">@person.ID</div>

                <div class="col col-2" data-label="Username" style="text-align: center; flex-basis: 25%">@person.Username</div>

                <div class="col col-3" data-label="Credentials" style="text-align: center; flex-basis: 5%"> @person.Employee_Number</div>

                <div class="col col-4" data-label="Log In" style="text-align: center; flex-basis: 20%"> @person.Login_session</div>

                <div class="col col-5" data-label="Type User" style="text-align: center; flex-basis: 10%"> @person.Type_user</div>

                <div class="col col-6" data-label="Date" style="text-align: center; flex-basis: 20%"> @person.DateAdded</div>

                <div class="col col-7" data-label="Options" style="text-align: center; flex-basis: 25%">

                    @if (person.Type_user == "HISENSE")
                    {
                        @: @Html.ActionLink("🪢 Asignacion de Areas", "Assignments", new { id = @person.ID, ETP = "HISENSE" }) /
                    }

                    @if (person.Type_user == "RADA")
                    {
                        @: @Html.ActionLink("🪢  Asignacion de Areas", "Assignments", new { id = @person.ID, ETP = "RADA" }) /
                    }

                    @Html.ActionLink("♻️ Actualizar", "UpdateProcess", new { ID = @person.ID }) /
                    @*@Html.ActionLink("❌ Delete", "RemoveUser", new { ID = @person.ID })*@
                    <a href="#" class="delete-user" data-id="@person.ID">❌ Eliminar</a>
                </div>

            </li>

        }
    </ul>
</div>

<p style="text-align: center;">&nbsp;</p>
<p style="text-align: center;">&nbsp;</p>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    $(document).ready(function () {
        $(".delete-user").click(function (e) {
            e.preventDefault();
            var userId = $(this).data("id");

            if (confirm("¿You are sure you want to delete this user?")) {
                $.ajax({
                    url: '@Url.Action("RemoveUser", "Users")',
                    type: 'POST',
                    data: { ID: userId },
                    success: function (response) {
                        // Aquí puedes actualizar la interfaz sin recargar
                        alert("User successfully eliminated.");
                        // Por ejemplo, puedes quitar la fila del usuario
                        location.reload(); // O mejor: remover el elemento directamente con jQuery
                    },
                    error: function () {
                        alert("An error occurred when trying to eliminate the driver.");
                    }
                });
            }
        });
    });
</script>